name: Notify on Push to UAT

on:
  push:
    branches:
      - UAT

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Get Commit Info
        id: get_commit
        run: |
          echo "COMMIT_MESSAGE=$(git log -1 --pretty=%B)" >> $GITHUB_ENV
          echo "COMMITTER_NAME=$(git log -1 --pretty='%cn')" >> $GITHUB_ENV
          echo "COMMIT_URL=https://github.com/${{ github.repository }}/commit/${{ github.sha }}" >> $GITHUB_ENV

      - name: Send Slack Notification
        uses: slackapi/slack-github-action@v1.24.0
        with:
          channel-id: C07GJ2TGW7N
          payload: |
            {
              "channel": "C07GJ2TGW7N",
              "text": "ðŸš€ Se han aÃ±adido nuevos cambios a la rama UAT",
              "attachments": [
                {
                  "color": "#36a64f",
                  "pretext": "Detalles del Ãºltimo commit:",
                  "fields": [
                    {
                      "title": "Mensaje del Commit",
                      "value": "${{ env.COMMIT_MESSAGE }}",
                      "short": false
                    },
                    {
                      "title": "Autor",
                      "value": "${{ env.COMMITTER_NAME }}",
                      "short": true
                    }
                  ],
                  "actions": [
                    {
                      "type": "button",
                      "text": "Ver Commit",
                      "url": "${{ env.COMMIT_URL }}",
                      "style": "primary"
                    }
                  ],
                  "footer": "GitHub Actions",
                  "footer_icon": "https://platform.slack-edge.com/img/default_application_icon.png",
                  "ts": "${{ github.event.head_commit.timestamp }}"
                }
              ]
            }
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
